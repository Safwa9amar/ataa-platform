enum StockChangeType {
  SALE // ğŸ›’ Ø¨ÙŠØ¹ Ù…Ù†ØªØ¬
  RESTOCK // ğŸ“¦ Ø¥Ø¹Ø§Ø¯Ø© ØªØ®Ø²ÙŠÙ†
  RESET // ğŸ”„ ØªØµÙÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
  ADJUSTMENT // âš™ï¸ ØªØ¹Ø¯ÙŠÙ„ ÙŠØ¯ÙˆÙŠ
  RETURN // â™»ï¸ Ø¥Ø±Ø¬Ø§Ø¹ Ù…Ù†ØªØ¬
  CANCEL_SALE // âŒ Ø¥Ù„ØºØ§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹
  CANCEL_RESTOCK // âŒ Ø¥Ù„ØºØ§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡
  RESERVE // â³ Ø­Ø¬Ø² Ù…Ø®Ø²ÙˆÙ†
  RELEASE_RESERVE // ğŸ”“ Ø¥Ù„ØºØ§Ø¡ Ø­Ø¬Ø² Ù…Ø®Ø²ÙˆÙ†
  DAMAGE // ğŸ·ï¸ Ø®ØµÙ… ØªØ§Ù„Ù
  INVENTORY_CHECK // ğŸ” Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
}

enum InvoiceStatus {
  PENDING // ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
  PAID // Ù…Ø¯ÙÙˆØ¹Ø©
  CANCELED // Ù…Ù„ØºØ§Ø©
}

enum ConfirmationStatus {
  PENDING_CHARITY // ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬Ù…Ø¹ÙŠØ©
  CONFIRMED_CHARITY // Ù…Ø¤ÙƒØ¯Ø© Ù…Ù† Ø§Ù„Ø¬Ù…Ø¹ÙŠØ©
  CONFIRMED_PLATFORM // Ù…Ø¤ÙƒØ¯Ø© Ù…Ù† Ø§Ù„Ù…Ù†ØµØ©
}

enum InvoiceTrackingStatus {
  PENDING_CHARITY // ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬Ù…Ø¹ÙŠØ©
  CONFIRMED_CHARITY // Ù…Ø¤ÙƒØ¯Ø© Ù…Ù† Ø§Ù„Ø¬Ù…Ø¹ÙŠØ©
  CONFIRMED_PLATFORM // Ù…Ø¤ÙƒØ¯Ø© Ù…Ù† Ø§Ù„Ù…Ù†ØµØ©
  PAID // Ù…Ø¯ÙÙˆØ¹Ø©
}

model Product {
  id                String   @id @default(uuid())
  name              String
  description       String?
  price             Float
  stock             Int      @default(0)
  imgURL            String   @default("https://ataa-platform.com/images/200/10033520/fullLogo.png")
  socialMediaLinks  String? // Changed from String? to Json? for structured data
  additionalDetails String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  storeCategoryId String
  category        StoreCategory @relation(fields: [storeCategoryId], references: [id])

  partnerId String?
  partner   Partner? @relation(fields: [partnerId], references: [id])

  fileID              String? @unique
  qualityCertificates File?   @relation(fields: [fileID], references: [id])

  productImages Image[] // Relationship with Image model

  minimumStockLevel Int?      @default(10)
  soldQuantity      Int       @default(0)
  lastStockUpdate   DateTime?
  restockDate       DateTime?

  stockHistory StockHistory[]
  donations    Donation[]

  invoiceProducts InvoiceProduct[]
}

model StockHistory {
  id         String          @id @default(uuid())
  productId  String
  product    Product         @relation(onDelete: Cascade, fields: [productId], references: [id])
  oldStock   Int
  newStock   Int
  changeType StockChangeType // Changed from String to Enum for consistency
  changedAt  DateTime        @default(now())
}

model StoreCategory {
  id          String    @id @default(uuid())
  name        String    @unique
  description String?
  color       String?   @default("#000")
  products    Product[]
}

model InvoiceProduct {
  id             String @id @default(uuid())
  productId      String
  invoiceId      String
  quantity       Int    @default(1)
  priceAtInvoice Float // Price of the product at the time of invoice

  product Product         @relation(fields: [productId], references: [id])
  invoice SupplierInvoice @relation(fields: [invoiceId], references: [id]) // Fixed typo in model name

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SupplierInvoice {
  id                    String        @id @default(uuid())
  donationOpportunityId String?
  issuedBySupplier      String? // Ø§Ù„Ù…ÙˆØ±Ø¯
  issuedToCharity       String? // Ø§Ù„Ø¬Ù…Ø¹ÙŠØ©
  amount                Float
  issueDate             DateTime
  paymentDate           DateTime?
  status                InvoiceStatus @default(PENDING)
  notes                 String?
  invoicePDF            String?

  // Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
  confirmationStatus    ConfirmationStatus? @default(PENDING_CHARITY) // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
  paymentStatus         PaymentStatus?      @default(UNPAID) // Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹
  confirmedByCharityAt  DateTime? // ØªØ§Ø±ÙŠØ® ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬Ù…Ø¹ÙŠØ©
  confirmedByPlatformAt DateTime? // ØªØ§Ø±ÙŠØ® ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ù†ØµØ©
  paidAt                DateTime? // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹
  platformConfirmedBy   String? // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ Ø£ÙƒØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù…Ù†ØµØ©
  charityId             String? // Ø§Ù„Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯Ø©

  invoiceProducts InvoiceProduct[]
  invoiceTracking InvoiceTracking[]

  partnerId String?
  partner   Partner? @relation(fields: [partnerId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([confirmationStatus])
  @@index([paymentStatus])
}

model InvoiceTracking {
  id        String                @id @default(uuid())
  invoiceId String
  invoice   SupplierInvoice       @relation(fields: [invoiceId], references: [id])
  status    InvoiceTrackingStatus // Ø­Ø§Ù„Ø© Ø§Ù„ØªØªØ¨Ø¹
  changedBy String // Ù…Ù† Ù‚Ø§Ù… Ø¨Ø§Ù„ØªØºÙŠÙŠØ± (Ø§Ù„Ø¬Ù…Ø¹ÙŠØ© Ø£Ùˆ Ø§Ù„Ù…Ù†ØµØ©)
  changedAt DateTime              @default(now()) // ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØºÙŠÙŠØ±

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
